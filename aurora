#!/bin/bash
# Aurora CLI Entry Point
AURORA_ROOT="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
export AURORA_ROOT

# Carregar m√≥dulos
for module in "$AURORA_ROOT"/src/modules/*.sh; do
	[ -r "$module" ] && source "$module"
done

show_cli_help() {
	clear
	local help_text=""
	help_text="${help_text}COMANDOS DISPON√çVEIS:\n\n"
	help_text="${help_text}  list             - Lista temas em UI rica\n"
	help_text="${help_text}  preview <tema>   - Visualiza√ß√£o com valida√ß√£o WCAG\n"
	help_text="${help_text}  apply <tema>     - Aplica tema e gera Starship din√¢mico\n"
	help_text="${help_text}  status           - Mostra estado e depend√™ncias\n"
	help_text="${help_text}  install <remoto> - Instala temas de reposit√≥rios externos\n"
	help_text="${help_text}  install-hooks    - Injeta carregamento autom√°tico no Shell\n"
	help_text="${help_text}  apply-current    - Restaura o √∫ltimo tema (boot/systemd)\n"
	help_text="${help_text}  help             - Mostra esta tela de ajuda\n\n"
	help_text="${help_text}Inspirado na paleta Ganache de tons de chocolate."

	draw_fancy_box "üç´ AURORA THEME MANAGER v3.0" "$help_text"
}

# Roteamento de comandos
case "${1:-help}" in
list)
	show_theme_list
	;;
preview)
	if [ -z "$2" ]; then
		echo "Uso: ./aurora preview <nome_tema>"
		exit 1
	fi
	show_preview "$2"
	;;
apply)
	if [ -z "$2" ]; then
		echo "Uso: ./aurora apply <nome_tema>"
		exit 1
	fi
	echo "Aplicando tema '$2'..."
	save_state "$2"
	apply_shell_hooks "$2"
	echo "Tema '$2' aplicado com sucesso."
	;;
status)
	show_status
	;;
install)
	if [ -z "$2" ]; then
		echo "Uso: ./aurora install <nome_tema_remoto>"
		exit 1
	fi
	fetch_remote_theme "$2"
	;;
install-hooks)
	echo "Injetando hooks de shell..."
	install_shell_hooks
	;;
apply-current)
	current=$(load_state)
	if [ -n "$current" ]; then
		save_state "$current"
		apply_shell_hooks "$current"
	else
		echo "Nenhum tema salvo."
	fi
	;;
help | *)
	show_cli_help
	;;
esac
